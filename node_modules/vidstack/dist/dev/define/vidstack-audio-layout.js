import { h as html, a as ref } from '../chunks/vidstack-Nzpo6ock.js';
import { n as signal, e as effect, Q as toggleClass, H as Host, o as onDispose, l as listenEvent, s as setAttribute } from '../chunks/vidstack-CXruz14q.js';
import { D as DefaultLayout, a as DefaultSeekButton, b as DefaultPlayButton, c as DefaultTimeSlider, d as DefaultTimeInvert, e as DefaultCaptionButton, f as DefaultChaptersMenu, g as DefaultSettingsMenu, u as useDefaultLayoutContext, h as DefaultControlsSpacer, i as DefaultMuteButton, j as DefaultVolumeSlider, k as i18n, l as DefaultChapterTitle, m as createMenuContainer, n as DefaultLayoutIconsLoader } from '../chunks/vidstack-B5Xu0kEG.js';
import { u as useMediaContext, b as useMediaState } from '../chunks/vidstack-Cs8ahLI-.js';
import { $ as $signal, S as SlotManager } from '../chunks/vidstack-BaBhuoCn.js';
import { L as LitElement } from '../chunks/vidstack-BOMxE8ob.js';
import { u as useTransitionActive, b as useResizeObserver, d as useActive, e as useMouseEnter, f as useRectCSSVars } from '../chunks/vidstack-CyiDQdIB.js';
import '../chunks/vidstack-xZ37JZ9V.js';
import '../chunks/vidstack-BilA8Hmg.js';
import '../chunks/vidstack-CnaYRoc3.js';
import '../chunks/vidstack-BLNW_fQy.js';
import '../chunks/vidstack-DLtp1VCK.js';
import '../chunks/vidstack-DWHAQsPW.js';
import '../chunks/vidstack-1gmLGa6x.js';
import '../chunks/vidstack-2fIzRyOW.js';
import '../chunks/vidstack-ChEoSTSp.js';
import '../chunks/vidstack-ksPACRiU.js';

let DefaultAudioLayout$1 = class DefaultAudioLayout extends DefaultLayout {
  static {
    this.props = {
      ...super.props,
      when: ({ viewType }) => viewType === "audio",
      smallWhen: ({ width }) => width < 576
    };
  }
};

function DefaultAudioLayout() {
  return [
    html`<media-captions class="vds-captions"></media-captions>`,
    html`
      <media-controls class="vds-controls">
        <media-controls-group class="vds-controls-group">
          ${[
      DefaultSeekButton({ backward: true, tooltip: "top start" }),
      DefaultPlayButton({ tooltip: "top" }),
      DefaultSeekButton({ tooltip: "top" }),
      DefaultAudioTitle(),
      DefaultTimeSlider(),
      DefaultTimeInvert(),
      DefaultAudioVolume(),
      DefaultCaptionButton({ tooltip: "top" }),
      DefaultAudioMenus()
    ]}
        </media-controls-group>
      </media-controls>
    `
  ];
}
function DefaultAudioTitle() {
  return $signal(() => {
    let $ref = signal(void 0), $isTextOverflowing = signal(false), media = useMediaContext(), { title, started, currentTime, ended } = useMediaState(), { translations } = useDefaultLayoutContext(), $isTransitionActive = useTransitionActive($ref), $isContinued = () => started() || currentTime() > 0;
    const $title = () => {
      const word = ended() ? "Replay" : $isContinued() ? "Continue" : "Play";
      return `${i18n(translations, word)}: ${title()}`;
    };
    effect(() => {
      if ($isTransitionActive() && document.activeElement === document.body) {
        media.player.el?.focus();
      }
    });
    function onResize() {
      const el = $ref(), isOverflowing = !!el && !$isTransitionActive() && el.clientWidth < el.children[0].clientWidth;
      el && toggleClass(el, "vds-marquee", isOverflowing);
      $isTextOverflowing.set(isOverflowing);
    }
    function Title() {
      return html`
        <span class="vds-title-text">
          ${$signal($title)}${$signal(() => $isContinued() ? DefaultChapterTitle() : null)}
        </span>
      `;
    }
    useResizeObserver($ref, onResize);
    return title() ? html`
          <span class="vds-title" title=${$signal($title)} ${ref($ref.set)}>
            ${[
      Title(),
      $signal(() => $isTextOverflowing() && !$isTransitionActive() ? Title() : null)
    ]}
          </span>
        ` : DefaultControlsSpacer();
  });
}
function DefaultAudioVolume() {
  return $signal(() => {
    const { pointer, muted } = useMediaState();
    if (pointer() === "coarse" && !muted())
      return null;
    const $rootRef = signal(void 0), $triggerRef = signal(void 0), $popperRef = signal(void 0), $isRootActive = useActive($rootRef), $hasMouseEnteredTrigger = useMouseEnter($triggerRef);
    effect(() => {
      if (!$hasMouseEnteredTrigger())
        return;
      useRectCSSVars($rootRef, $triggerRef, "trigger");
      useRectCSSVars($rootRef, $popperRef, "popper");
    });
    return html`
      <div class="vds-volume" ?data-active=${$signal($isRootActive)} ${ref($rootRef.set)}>
        ${DefaultMuteButton({ tooltip: "top", ref: $triggerRef.set })}
        <div class="vds-volume-popup" ${ref($popperRef.set)}>
          ${DefaultVolumeSlider({ orientation: "vertical" })}
        </div>
      </div>
    `;
  });
}
function DefaultAudioMenus() {
  const placement = "top end";
  return [
    DefaultChaptersMenu({ tooltip: "top", placement, portal: true }),
    DefaultSettingsMenu({ tooltip: "top end", placement, portal: true })
  ];
}

class MediaAudioLayoutElement extends Host(LitElement, DefaultAudioLayout$1) {
  constructor() {
    super(...arguments);
    this._scrubbing = signal(false);
  }
  static {
    this.tagName = "media-audio-layout";
  }
  static {
    this.attrs = {
      smallWhen: {
        converter(value) {
          return value !== "never" && !!value;
        }
      }
    };
  }
  onSetup() {
    this.forwardKeepAlive = false;
    this._media = useMediaContext();
    this.classList.add("vds-audio-layout");
    this.menuContainer = createMenuContainer("vds-audio-layout");
    effect(() => {
      if (!this.menuContainer)
        return;
      setAttribute(this.menuContainer, "data-size", this.isSmallLayout && "sm");
    });
    const { pointer } = this._media.$state;
    effect(() => {
      if (pointer() !== "coarse")
        return;
      effect(this._watchScrubbing.bind(this));
    });
    onDispose(() => this.menuContainer?.remove());
  }
  onConnect() {
    this._media.player.el?.setAttribute("data-layout", "audio");
    onDispose(() => this._media.player.el?.removeAttribute("data-layout"));
    effect(() => {
      if (this.$props.customIcons()) {
        new SlotManager(this).connect();
      } else {
        new DefaultLayoutIconsLoader(this).connect();
      }
    });
  }
  render() {
    return html`${$signal(this._render.bind(this))}`;
  }
  _render() {
    return this.isMatch ? DefaultAudioLayout() : null;
  }
  _watchScrubbing() {
    if (!this._scrubbing()) {
      listenEvent(this, "pointerdown", this._onStartScrubbing.bind(this), { capture: true });
      return;
    }
    listenEvent(this, "pointerdown", (e) => e.stopPropagation());
    listenEvent(window, "pointerdown", this._onStopScrubbing.bind(this));
  }
  _onStartScrubbing(event) {
    const { target } = event, hasTimeSlider = !!(target instanceof HTMLElement && target.closest(".vds-time-slider"));
    if (!hasTimeSlider)
      return;
    event.stopImmediatePropagation();
    this.setAttribute("data-scrubbing", "");
    this._scrubbing.set(true);
  }
  _onStopScrubbing() {
    this._scrubbing.set(false);
    this.removeAttribute("data-scrubbing");
  }
}

export { MediaAudioLayoutElement };
