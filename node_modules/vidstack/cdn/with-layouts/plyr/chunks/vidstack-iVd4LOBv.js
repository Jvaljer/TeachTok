import{G as p,g as J,b as d,l as g,Z as k,D as o,a as m,j as T}from"./vidstack-DDS6k7mb.js";function E(i,t){const s=new URLSearchParams;for(const e of Object.keys(t))s.set(e,t[e]+"");return i+"?"+s.toString()}function M(i,t="preconnect"){const s=document.querySelector(`link[href="${i}"]`);if(!p(s))return!0;const e=document.createElement("link");return e.rel=t,e.href=i,e.crossOrigin="true",document.head.append(e),!0}const u={};function x(i){if(u[i])return u[i].promise;const t=J(),s=document.querySelector(`script[src="${i}"]`);if(!p(s))return t.resolve(),t.promise;const e=document.createElement("script");return e.src=i,e.onload=()=>{t.resolve(),delete u[i]},e.onerror=()=>{t.reject(),delete u[i]},setTimeout(()=>document.head.append(e),0),t.promise}function f(i){return i==="use-credentials"?"include":d(i)?"same-origin":void 0}const V=Symbol(0),j=Symbol(0),O=Symbol(0),P=Symbol(0),W=Symbol(0),$=Symbol(0),I=Symbol(0),c={al:V,M:j,Ta:O,P,Ua:W,T:$,te:I};function l(i,t){return t>=i.startTime&&t<i.endTime}function y(i,t,s){let e=null;function n(){const a=d(t)?[t]:t,r=i.toArray().find(h=>a.includes(h.kind)&&h.mode==="showing");if(r!==e){if(!r){s(null),e=null;return}r.readyState==2?s(r):(s(null),r.addEventListener("load",()=>s(r),{once:!0})),e=r}}return n(),g(i,"mode-change",n)}function R(i,t,s){y(i,t,e=>{if(!e){s("");return}const n=()=>{const a=e?.activeCues[0];s(a?.text||"")};n(),g(e,"cue-change",n)})}var v,b,w;class A extends k{constructor(t){super(),this.id="",this.label="",this.language="",this.default=!1,this.P=!1,this.Va=0,this.I="disabled",this.ue={},this.ac=[],this.J=[],this.Wa=[],this[v]=0,this[b]=null,this[w]=null;for(const s of Object.keys(t))this[s]=t[s];this.type||(this.type="vtt"),t.content?import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js").then(({parseText:s,VTTCue:e,VTTRegion:n})=>{!d(t.content)||t.type==="json"?(this.ve(t.content,e,n),this.readyState!==3&&this.M()):s(t.content,{type:t.type}).then(({cues:a,regions:r})=>{this.J=a,this.ac=r,this.M()})}):t.src||(this[c.M]=2)}static createId(t){return`id::${t.type}-${t.kind}-${t.src??t.label}`}get metadata(){return this.ue}get regions(){return this.ac}get cues(){return this.J}get activeCues(){return this.Wa}get readyState(){return this[c.M]}get mode(){return this.I}set mode(t){this.setMode(t)}addCue(t,s){let e=0,n=this.J.length;for(e=0;e<n&&!(t.endTime<=this.J[e].startTime);e++);e===n?this.J.push(t):this.J.splice(e,0,t),s?.type!=="cuechange"&&this[c.T]?.track.addCue(t),this.dispatchEvent(new o("add-cue",{detail:t,trigger:s})),l(t,this.Va)&&this[c.Ta](this.Va,s)}removeCue(t,s){const e=this.J.indexOf(t);if(e>=0){const n=this.Wa.includes(t);this.J.splice(e,1),this[c.T]?.track.removeCue(t),this.dispatchEvent(new o("remove-cue",{detail:t,trigger:s})),n&&this[c.Ta](this.Va,s)}}setMode(t,s){this.I!==t&&(this.I=t,t==="disabled"?(this.Wa=[],this.we()):this.readyState===2?this[c.Ta](this.Va,s):this.xe(),this.dispatchEvent(new o("mode-change",{detail:this,trigger:s})),this[c.Ua]?.())}[(v=c.M,b=c.Ua,w=c.T,c.Ta)](t,s){if(this.Va=t,this.mode==="disabled"||!this.J.length)return;const e=[];for(let a=0,r=this.J.length;a<r;a++){const h=this.J[a];l(h,t)&&e.push(h)}let n=e.length!==this.Wa.length;if(!n){for(let a=0;a<e.length;a++)if(!this.Wa.includes(e[a])){n=!0;break}}this.Wa=e,n&&this.we(s)}[c.P](){this.P=!0,this.I!=="disabled"&&this.xe()}async xe(){if(!(!this.P||!this.src||this[c.M]>0)){this[c.M]=1,this.dispatchEvent(new o("load-start"));try{const{parseResponse:t,VTTCue:s,VTTRegion:e}=await import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js"),n=this[c.al]?.(),a=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:f(n)});if(this.type==="json")this.ve(await(await a).text(),s,e);else{const{errors:r,metadata:h,regions:S,cues:C}=await t(a,{type:this.type,encoding:this.encoding});if(r[0]?.code===0)throw r[0];this.ue=h,this.ac=S,this.J=C}this.M()}catch(t){this.ye(t)}}}M(){if(this[c.M]=2,!this.src||this.type!=="vtt"){const s=this[c.T]?.track;if(s)for(const e of this.J)s.addCue(e)}const t=new o("load");this[c.Ta](this.Va,t),this.dispatchEvent(t)}ye(t){this[c.M]=3,this.dispatchEvent(new o("error",{detail:t}))}ve(t,s,e){try{const{regions:n,cues:a}=q(t,s,e);this.ac=n,this.J=a}catch(n){this.ye(n)}}we(t){this.dispatchEvent(new o("cue-change",{trigger:t}))}}const U=/captions|subtitles/;function N(i){return U.test(i.kind)}function q(i,t,s){const e=d(i)?JSON.parse(i):i;let n=[],a=[];return e.regions&&s&&(n=e.regions.map(r=>Object.assign(new s,r))),(e.cues||m(e))&&(a=(m(e)?e:e.cues).filter(r=>T(r.startTime)&&T(r.endTime)).map(r=>Object.assign(new t(0,0,""),r))),{regions:n,cues:a}}export{c as T,A as a,l as b,R as c,E as d,f as g,N as i,x as l,M as p,y as w};
