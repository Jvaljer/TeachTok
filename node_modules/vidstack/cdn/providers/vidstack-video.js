import{o as h,l as r,D as p,s as m,e as g,A as f}from"../chunks/vidstack-CPEIdVRF.js";import{g as u,h as d,j as b}from"../chunks/vidstack-uiCjUynR.js";import{HTMLMediaProvider as k}from"./vidstack-html.js";import{a as P,T as c}from"../chunks/vidstack-BOKjmd0C.js";import"../chunks/vidstack-UD99SRPR.js";import"../chunks/vidstack-BKXnCvnV.js";import"../chunks/vidstack-UVfmP_-r.js";class y{constructor(t,e){this.m=t,this.b=e,t.textTracks.onaddtrack=this.Wc.bind(this),h(this.cd.bind(this))}Wc(t){const e=t.track;if(!e||v(this.m,e))return;const i=new P({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[c.T]={track:e},i[c.M]=2,i[c.te]=!0;let n=0;const o=l=>{if(e.cues)for(let a=n;a<e.cues.length;a++)i.addCue(e.cues[a],l),n++};o(t),e.oncuechange=o,this.b.textTracks.add(i,t),i.setMode(e.mode,t)}cd(){this.m.textTracks.onaddtrack=null;for(const t of this.b.textTracks){const e=t[c.T]?.track;e?.oncuechange&&(e.oncuechange=null)}}}function v(s,t){return Array.from(s.children).find(e=>e.track===t)}class w{constructor(t,e){this.m=t,this.a=e,this.B=(i,n)=>{this.a.delegate.c("picture-in-picture-change",i,n)},r(this.m,"enterpictureinpicture",this.Jg.bind(this)),r(this.m,"leavepictureinpicture",this.Kg.bind(this))}get active(){return document.pictureInPictureElement===this.m}get supported(){return u(this.m)}async enter(){return this.m.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}Jg(t){this.B(!0,t)}Kg(t){this.B(!1,t)}}class I{constructor(t,e){this.m=t,this.a=e,this.I="inline",r(this.m,"webkitpresentationmodechanged",this.Ua.bind(this))}get Se(){return d(this.m)}async kc(t){this.I!==t&&this.m.webkitSetPresentationMode(t)}Ua(t){const e=this.I;this.I=this.m.webkitPresentationMode,this.a.player?.dispatch(new p("video-presentation-change",{detail:this.I,trigger:t})),["fullscreen","picture-in-picture"].forEach(i=>{(this.I===i||e===i)&&this.a.delegate.c(`${i}-change`,this.I===i,t)})}}class T{constructor(t){this.fa=t}get active(){return this.fa.I==="fullscreen"}get supported(){return this.fa.Se}async enter(){this.fa.kc("fullscreen")}async exit(){this.fa.kc("inline")}}class x{constructor(t){this.fa=t}get active(){return this.fa.I==="picture-in-picture"}get supported(){return this.fa.Se}async enter(){this.fa.kc("picture-in-picture")}async exit(){this.fa.kc("inline")}}class S{constructor(t,e){this.m=t,this.b=e,this.Se=m(!1),this.Hm()}get supported(){return this.Se()}Hm(){!this.m.remote||!this.sl||(this.m.remote.watchAvailability(t=>{this.Se.set(t)}).catch(()=>{this.Se.set(!1)}),g(this.rn.bind(this)))}rn(){if(!this.Se())return;const t=["connecting","connect","disconnect"],e=this.Rg.bind(this);e(),r(this.m,"playing",e);for(const i of t)r(this.m.remote,i,e)}async prompt(){if(!this.supported)throw Error("Not supported on this platform.");return this.vb==="airplay"&&this.m.webkitShowPlaybackTargetPicker?this.m.webkitShowPlaybackTargetPicker():this.m.remote.prompt()}Rg(t){const e=this.m.remote.state;if(e===this.mc)return;const i={type:this.vb,state:e};this.b.delegate.c("remote-playback-change",i,t),this.mc=e}}class A extends S{constructor(){super(...arguments),this.vb="airplay"}get sl(){return"WebKitPlaybackTargetAvailabilityEvent"in window}}class E extends k{constructor(t,e){super(t,e),this.$$PROVIDER_TYPE="VIDEO",f(()=>{if(this.airPlay=new A(t,e),d(t)){const i=new I(t,e);this.fullscreen=new T(i),this.pictureInPicture=new x(i)}else u(t)&&(this.pictureInPicture=new w(t,e))},this.scope)}get type(){return"video"}setup(){super.setup(),b(this.video)&&new y(this.video,this.b),this.b.textRenderers.Fe(this.video),h(()=>{this.b.textRenderers.Fe(null)}),this.type==="video"&&this.b.delegate.c("provider-setup",this)}get video(){return this.a}}export{E as VideoProvider};
