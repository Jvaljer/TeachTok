"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getRegisteredServices = void 0;
const fs_1 = require("fs");
const path_1 = require("path");
async function getRegisteredServices(app) {
    if (app.get('database') === 'mongodb') {
        const db = await app.get('mongoClient');
        const collections = await db.collections();
        return collections.map((x) => x.collectionName).filter((x) => x !== 'authentication');
    }
    else if (app.get('database') === 'nedb') {
        const dbPath = app.get('nedb');
        if ((0, fs_1.existsSync)(dbPath)) {
            const files = (0, fs_1.readdirSync)(dbPath);
            return files
                .filter((f) => (0, path_1.extname)(f) === '.db')
                .map((x) => (0, path_1.parse)(x).name)
                .filter((x) => x !== 'authentication');
        }
        return [];
    }
    else {
        throw new Error('Invalid database type: only "nedb" or "mongodb" are currently supported');
    }
}
exports.getRegisteredServices = getRegisteredServices;
